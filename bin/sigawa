#!/usr/bin/env php
<?php
require_once __DIR__ . '/../includes/bootstrap.php';

use McConsole\Handlers\ProjectHandler;
use McConsole\Handlers\ControllerHandler;
use McConsole\Handlers\ModelHandler;
use McConsole\Handlers\ServiceHandler;
use McConsole\Handlers\PackageHandler;
use McConsole\Utils\Cli;

$args = Cli::parse($argv);
$command = $args['command'];
$name = $args['name'];
$options = $args['options'];

switch ($command) {
    case 'create:project':
        echo "Enter the project name: ";
        $projectName = trim(fgets(STDIN));
        ProjectHandler::handle($projectName);
        break;

    case 'make:controller':
        ControllerHandler::handle($name, $options);
        break;

    case 'make:model':
        ModelHandler::handle($name);
        break;

    case 'make:service':
        ServiceHandler::handle($name);
        break;

    case 'make:package':
        PackageHandler::handle($name, $options);
        break;

    case 'serve':
        $cwd = getcwd(); // Get the directory from which the command is being run
        $publicDir = $cwd . '/public';

        if (!is_dir($publicDir)) {
            echo "❌ Public directory not found at: $publicDir\n";
            break;
        }

        chdir($publicDir);
        echo "🌐 Server started at http://localhost:8000\n";
        passthru("php -S localhost:8000");
        break;

    default:
        echo <<<TXT
Available Commands:
  php mcconsole create:project
  php mcconsole make:model Name
  php mcconsole make:controller Name [--resource] [--with-service]
  php mcconsole make:service Name
  php mcconsole make:package Name [--resource]
  php mcconsole serve

TXT;
        break;
}
